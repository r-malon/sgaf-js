generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Local {
  id              Int    @id @default(autoincrement())
  nome            String @unique
  nome_normalized String @unique

  instalacoes Instalacao[]
}

model Contrato {
  id       Int    @id @default(autoincrement())
  numero   String @unique
  nome     String
  endereco String
  cpf      String

  afs AF[]
}

model AF {
  id          Int      @id @default(autoincrement())
  contratoId  Int
  principal   Boolean
  numero      String   @unique
  fornecedor  String
  descricao   String?
  data_inicio DateTime
  data_fim    DateTime
  status      Boolean

  contrato       Contrato @relation(fields: [contratoId], references: [id], onDelete: Restrict)
  items          Item[]
  principalItems Item[]   @relation("principalItems")
  valores        Valor[]

  @@index([contratoId])
}

model Item {
  id                Int       @id @default(autoincrement())
  principalId       Int
  descricao         String?
  data_alteracao    DateTime?
  banda_maxima      Int
  quantidade_maxima Int

  principal   AF           @relation("principalItems", fields: [principalId], references: [id], onDelete: Restrict)
  afs         AF[]
  valores     Valor[]
  instalacoes Instalacao[]

  @@index([principalId])
}

model Instalacao {
  id                 Int       @id @default(autoincrement())
  itemId             Int
  localId            Int
  banda_instalada    Int
  data_instalacao    DateTime
  data_desinstalacao DateTime?
  quantidade         Int
  status             Boolean

  item  Item  @relation(fields: [itemId], references: [id], onDelete: Cascade)
  local Local @relation(fields: [localId], references: [id], onDelete: Restrict)

  @@unique([itemId, localId])
  @@index([itemId])
  @@index([localId])
}

model Valor {
  id          Int       @id @default(autoincrement())
  itemId      Int
  afId        Int
  valor       Int
  data_inicio DateTime
  data_fim    DateTime?

  item Item @relation(fields: [itemId], references: [id], onDelete: Restrict)
  af   AF   @relation(fields: [afId], references: [id], onDelete: Restrict)

  @@index([itemId])
  @@index([afId])
}
